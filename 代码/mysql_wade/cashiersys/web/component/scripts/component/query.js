(function(){if(typeof(Wade.component.query)=='undefined'){Wade.component.query=(function(){ var dom=Wade.dom; var util=Wade.util; var ajax=Wade.ajax;  return {    encodeCriteriaExport:function(cond_group) {   var str = "";   var count = 0;      for (var i=0; i<document.forms.length; i++) {    var theForm = document.forms[i];    for (var j=0; j<theForm.elements.length; j++) {     var element = theForm.elements[j];     var name = element.name;     var desc = element.getAttribute("desc") == null ? "FIELD_DESC" : element.getAttribute("desc");     var value = element.value;     var text = element.value;     var isvalid = false;          if (element.tagName == "INPUT" || element.tagName == "SELECT" || element.tagName == "TEXTAREA") {      if (cond_group != null && !name.startsWith(cond_group)) {       continue;      }      if (name == null || desc == null || value == null) {       continue;      }            if (element.type.toUpperCase() == "TEXT") {       if (value == "") continue;       if (element.getAttribute("fieldName") != null && dom.getElement(element.getAttribute("fieldName")) != null) {        continue;       }       isvalid = true;      }      if (element.type.toUpperCase() == "HIDDEN") {       if (element.getAttribute("textName") != null) {        var popfield = dom.getElement(element.getAttribute("textName"));        if (popfield != null) text = popfield.value;       }       if (value == "" && text == "") continue;       isvalid = true;      }      if (element.tagName == "SELECT") {       if (value == "") continue;       text = element.options[element.selectedIndex].text;       isvalid = true;      }      if (element.tagName == "TEXTAREA") {       if (value == "") continue;       isvalid = true;      }            if (isvalid) {       count ++;       str += util.getStrByPadLength(name) + util.getStrByPadLength(desc) + util.getStrByPadLength(value) + util.getStrByPadLength(text);      }     }    }   }      return util.getStrByPadPrefix(4) + util.getStrByPadPrefix(count) + str;  },  decodeCriteria:function (encodestr) {   var encodename = ["NAME","DESC","VALUE","TEXT"];      var urlstr = "", descstr = "";   var array = util.getArrayByEncodeStr(encodename, encodestr);   dom.getElement("CRIT_CONDITION").innerHTML = "";   for (var i=0; i<array.length; i++) {    var name = array[i]["NAME"];    var desc = array[i]["DESC"];    var value = array[i]["VALUE"];    var text = array[i]["TEXT"];        if (dom.getElement(name) == null) {     var element = document.createElement("INPUT");     element.setAttribute("type", "hidden");     element.setAttribute("name", name);     element.setAttribute("value", value);     dom.getElement("CRIT_CONDITION").appendChild(element);    }    urlstr += "&" + name + "=" + value;    descstr += desc + "=" + text + (i != array.length - 1 ? ", " : "");   }      return { "URL" : urlstr, "DESC" : descstr };  },    decodeCriteriaExport:function (encodestr) {   var encodename = ["NAME","DESC","VALUE","TEXT"];      var urlstr = "", descstr = "";   var array = util.getArrayByEncodeStr(encodename, encodestr);   dom.getElement("CRIT_CONDITION").innerHTML = "";   for (var i=0; i<array.length; i++) {    var name = array[i]["NAME"];    var desc = array[i]["DESC"];    var value = array[i]["VALUE"];    var text = array[i]["TEXT"];        if (dom.getElement(name) == null) {     var element = document.createElement("INPUT");     element.type = "hidden";     element.name = name;     element.value = value;     dom.getElement("CRIT_CONDITION").appendChild(element);    }    urlstr += "&" + name + "=" + value;    descstr += desc + "=" + text + (i != array.length - 1 ? ", " : "");   }      return { "URL" : urlstr, "DESC" : descstr };  },    viewCriteria:function (title, encodestr) {   var datas = this.decodeCriteria(encodestr);   dom.getElement("CRIT_NAME").value = title;   dom.getElement("CRIT_REMARK").value = encodestr;   dom.getElement("QUERY_DESC").innerHTML = datas["DESC"];   dom.getElement("CriteriaPane").style.display = "none";   dom.getElement('POP_IMG_CRIT_NAME').setAttribute('oper', '0');   dom.getElement('POP_IMG_CRIT_NAME').className = 'e_buttonSelect';  },  buildCriterias:function(ajaxData) {   var items = dom.getElement("CriteriaItems");   if(ajaxData && items){    var content="";    ajaxData.each(function(data){     content = content+'<li><div class="fct2">';     content = content+'<a class="e_bLinkRewriteNB" crit_id="'+data.get('CRIT_ID')+'" href="javascript:void(0);" onclick="Wade.component.query.showRenameCriteria(getAttribute(\'crit_id\'), true)" title="\u91cd\u547d\u540d"><span></span></a>';     content = content+'<a class="e_bLinkDeleteNB" crit_id="'+data.get('CRIT_ID')+'" href="javascript:void(0);" onclick="return Wade.component.query.deleteCriteria(this);" title="\u5220\u9664"><span></span></a>';     content = content+'</div>';     content = content+'<a class="op" id="link_'+data.get('CRIT_ID')+'" crit_name="'+data.get('CRIT_NAME')+'" href="javascript:void(0);" content="'+data.get('CRIT_REMARK')+'" onclick="return Wade.component.query.viewCriteria(getAttribute(\'crit_name\'), getAttribute(\'content\'));"><span>'+data.get('CRIT_NAME')+'</span></a>';     content = content+'<div class="op" id="div_'+data.get('CRIT_ID')+'" style="display:none">';     content = content+'<input class="e_input" type="text" id="input_'+data.get('CRIT_ID')+'" name="input_'+data.get('CRIT_ID')+'" value="'+data.get('CRIT_NAME')+'" onkeydown="return Wade.component.query.renameKeyDown();"/>';     content = content+'<input class="e_button" type="button" onclick="return Wade.component.query.renameCriteria('+data.get('CRIT_ID')+');" value="\u786e\u5b9a" />';     content = content+'</div>';     content = content+'</li>';    });    items.innerHTML=content;   }  },  renameKeyDown:function() {   if(event.keyCode == 13) return false;  },  queryCriterias:function(obj) {   var oper = obj.getAttribute('oper');   if (oper != null && oper == '1') {    document.getElementById('CriteriaPane').style.display = 'none';    obj.setAttribute('oper', '0');    obj.className = 'e_buttonSelect';   } else {    obj.setAttribute('oper', '1');    obj.className = 'e_buttonSelectUp';    ajax.ajaxDirect('component.query.QueryPage', 'queryCriterias', '&CRIT_CLASS=' + dom.getElementValue("CRIT_CLASS"), 'CriteriaPart', null,      function(r){      Wade.component.query.buildCriterias(this.ajaxDataset);      document.getElementById('CriteriaPane').style.display = 'block';      Wade.page.endPageLoading();     });   }  },  showRenameCriteria:function(id, show) {   event.srcElement.className='e_bLinkRewriteNBDis';   dom.hidden(dom.getElement('link_'+id), show);   dom.hidden(dom.getElement('div_'+id), !show);  },  renameCriteria:function(id) {   var rename = dom.getElementValue('input_'+id);   if (rename=="") {    alert("\u91cd\u547d\u540d\u5931\u8d25\uff1a\u65b9\u6848\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01");    dom.getElement('input_'+id).focus();    return false;   }   ajax.ajaxDirect('component.query.QueryPage', 'saveCriteria', '&CRIT_ID='+id+'&CRIT_NAME='+rename+'&CRIT_CLASS=' + dom.getElementValue("CRIT_CLASS"), 'CriteriaPart', null,     function(r){     alert("\u65b9\u6848\u91cd\u547d\u540d\u6210\u529f\uff01");     Wade.component.query.buildCriterias(this.ajaxDataset);     Wade.page.endPageLoading();    });   return true;  },  deleteCriteria:function(obj) {   if (window.confirm('\u786e\u5b9a\u5220\u9664\u8be5\u65b9\u6848\u4e48\uff1f')) {    ajax.ajaxDirect('component.query.QueryPage', 'deleteCriteria', '&CRIT_CLASS='+dom.getElementValue("CRIT_CLASS")+'&CRIT_ID='+obj.getAttribute("crit_id"), 'CriteriaPart', null,      function(r){      alert("\u65b9\u6848\u5220\u9664\u6210\u529f\uff01");      Wade.component.query.buildCriterias(this.ajaxDataset);      Wade.page.endPageLoading();     });    return true;   } else {    return false;   }  },    configCriteria:function(obj) {   popupDialog(obj.getAttribute("param2"), obj.getAttribute("param3"), "&refresh="+getAttributeValue(obj, "param6", "true")+"&EXEC_CONDITION=" + dom.getElementValue("CRIT_REMARK") + obj.getAttribute("parameters"), obj.getAttribute("param1"), obj.getAttribute("param4"), obj.getAttribute("param5"));  },    createCriteria:function (obj) {   var crit_name = dom.getElement("CRIT_NAME");   var query_desc = dom.getElement("QUERY_DESC");   var crit_remark = dom.getElement("CRIT_REMARK");      if (query_desc.innerHTML == "" && obj.getAttribute("open") != "true") {    alert("\u8BF7\u5148\u914D\u7F6E\u9700\u4FDD\u5B58\u7684\u5B9A\u5236\u65B9\u6848\uFF01");    crit_name.focus();    return false;   }   if (crit_name.value == "" || crit_name.value == "\u8BF7\u9009\u62E9\u5B9A\u5236\u65B9\u6848..." || crit_name.value == "\u8BF7\u8F93\u5165\u65B9\u6848\u540D\u79F0...") {    alert("\u8BF7\u8F93\u5165\u9700\u4FDD\u5B58\u7684\u81EA\u5B9A\u4E49\u65B9\u6848\u540D\u79F0");    crit_name.focus();    return false;   }   if (!checkMaxLength(crit_name, 200, "\u65B9\u6848\u540D\u79F0")) return false;   if (!confirmInfo(obj, "\u786E\u5B9A\u4FDD\u5B58\u4E3A\u5B9A\u5236\u65B9\u6848\u4E48\uFF1F")) return false;      var params = "&CRIT_CLASS=" + obj.getAttribute("crit_class") + "&CRIT_NAME=" + crit_name.value + "&CRIT_REMARK=" + crit_remark.value;   ajax.ajaxDirect('component.query.QueryPage', "createCriteria", params, "CriteriaPart",null,function(r){    alert('\u5B9A\u5236\u65B9\u6848\u4FDD\u5B58\u6210\u529F\uFF01');    Wade.page.endPageLoading();   });      return true;  },  criteriaExport:function(obj) {   var me=this;   var query_desc = dom.getElement("QUERY_DESC");   if (query_desc.innerHTML == "" && obj.getAttribute("open") != "true") {    alert("\u8BF7\u9009\u62E9\u5DF2\u6709\u65B9\u6848\u6216\u914D\u7F6E\u65B0\u65B9\u6848\u8FDB\u884C\u5BFC\u51FA\uFF01");    query_desc.focus();    return false;   }   var privCtrl = obj.getAttribute('privCtrl');   var hasPrivSimpexp = hasPriv("COM_SIMPLEEXP_" + obj.getAttribute("critClass"));   var hasPrivCritexp = hasPriv("COM_CRITERIAEXP_" + obj.getAttribute("critClass"));   if (privCtrl == "true" && !hasPrivSimpexp && !hasPrivCritexp) {    alert("\u60a8\u6ca1\u6709\u6279\u91cf\u5bfc\u51fa\u6743\u9650\uff0c\u65e0\u6cd5\u7ee7\u7eed\u64cd\u4f5c\uff01\n\u5982\u679c\u9700\u8981\u64cd\u4f5c\u6b64\u529f\u80fd\uff0c\u8bf7\u4e0e\u7ba1\u7406\u4eba\u5458\u8054\u7cfb\uff01");    return false;   }   var f = confirm("\u786e\u5b9a\u8981\u5b9a\u65f6\u5bfc\u51fa\u5417\uff1f\n\u70b9\uff3b\u786e\u5b9a\uff3d\u6309\u94ae\uff1a\u8fdb\u5165\u5b9a\u65f6\u5bfc\u51fa\u914d\u7f6e\u9875\uff08\u5927\u6570\u636e\u91cf\u65f6\u5efa\u8bae\u6b64\u64cd\u4f5c\uff09\uff1b\n\u70b9\uff3b\u53d6\u6d88\uff3d\u6309\u94ae\uff1a\u5373\u65f6\u5bfc\u51fa\u6570\u636e\uff08\u5c0f\u6570\u636e\u91cf\u65f6\u5efa\u8bae\u6b64\u64cd\u4f5c\uff09\uff1b");         return this.criteriaExportCheck(f,obj);  },    criteriaExportCheck:function(result, obj) {   var encodestr = "", decodedatas, oper_mode;      var query_desc = dom.getElement("QUERY_DESC");   if (query_desc != null) {    encodestr = this.encodeCriteriaExport(obj.getAttribute("conditionGroup"));    decodedatas = this.decodeCriteriaExport(encodestr);   } else {    if (query_desc.innerHTML == "" && obj.getAttribute("open") != "true") {     alert("\u8BF7\u9009\u62E9\u5DF2\u6709\u65B9\u6848\u6216\u914D\u7F6E\u65B0\u65B9\u6848\u8FDB\u884C\u5BFC\u51FA\uFF01");     focus(query_desc);     return false;    }    encodestr = dom.getElementValue("CRIT_REMARK");    decodedatas = this.decodeCriteria(encodestr);    oper_mode = obj.getAttribute("critClass");   }      var exec_condition = encodestr;   var crit_desc = decodedatas["DESC"];   var exec_url = decodedatas["URL"];     var privCtrl = obj.getAttribute('privCtrl');   var hasPrivSimpexp = hasPriv("COM_SIMPLEEXP_" + obj.getAttribute("critClass"));   var hasPrivCritexp = hasPriv("COM_CRITERIAEXP_" + obj.getAttribute("critClass"));   if (privCtrl == "true" && !hasPrivSimpexp && !hasPrivCritexp) {    alert("\u60a8\u6ca1\u6709\u6279\u91cf\u5bfc\u51fa\u6743\u9650\uff0c\u65e0\u6cd5\u7ee7\u7eed\u64cd\u4f5c\uff01\n\u5982\u679c\u9700\u8981\u64cd\u4f5c\u6b64\u529f\u80fd\uff0c\u8bf7\u4e0e\u7ba1\u7406\u4eba\u5458\u8054\u7cfb\uff01");    return false;   }      var confirmExport = result;   if (confirmExport) {    if (privCtrl == "false" || (privCtrl == "true" && hasPrivCritexp)) {     if (obj.getAttribute("exportConfigPath") == "") {      alert("\u5B9A\u65F6\u5BFC\u51FA\u4E8B\u4EF6\u672A\u6307\u5B9A\uFF01");      return false;     }     if (obj.getAttribute("exportConfigFile") == "") {      alert("\u5B9A\u65F6\u5BFC\u51FA\u914D\u7F6E\u6587\u4EF6\u672A\u6307\u5B9A\uFF01");      return false;     }     var params = "&CRIT_CLASS=" + obj.getAttribute("critClass") + "&refresh=true&EXEC_PATH=" + obj.getAttribute("exportConfigPath") + "&CONFIG_FILE=" + obj.getAttribute("exportConfigFile") + "&EXEC_CONDITION=" + exec_condition + "&EXEC_GROUP=" + obj.getAttribute("conditionGroup") + "&CRIT_DESC=" + crit_desc + "&NEED_LOG=" + obj.getAttribute("needLog");     popupDialog('component.query.ExportConfig', 'inputCriteriaExec', params, '\u5B9A\u65F6\u5BFC\u51FA\u914D\u7F6E', 600, 400);     return true;    }    } else {    if (privCtrl == "false" || (privCtrl == "true" && hasPrivSimpexp)) {     var exportSimplePath = obj.getAttribute("exportSimplePath");     if (exportSimplePath == "") {      alert("\u5373\u65F6\u5BFC\u51FA\u4E8B\u4EF6\u672A\u914D\u7F6E\uFF01");      return false;     }     var privCode = privCtrl == "false" ? null : obj.getAttribute("critClass");     if (!exportFile(exportSimplePath.split("@")[0], exportSimplePath.split("@")[1], exec_url, privCode, null, oper_mode)) return false;     return true;    }   }   return true;  },    criteriaQuery:function (obj) {   var query_desc = dom.getElement("QUERY_DESC");   if (query_desc.innerHTML == "" && obj.getAttribute("open") != "true") {    alert("\u8BF7\u9009\u62E9\u5DF2\u6709\u65B9\u6848\u6216\u914D\u7F6E\u65B0\u65B9\u6848\u8FDB\u884C\u67E5\u8BE2\uFF01");    query_desc.focus();    return false;   }   return true;  } }})();}})();