(function(){ function compareDomain(target) {  try {   return target.document.domain == document.domain;  } catch (e) {   return false;  } };  var sameTopDomain = compareDomain(top); var sameParentDomain = compareDomain(parent); var isPopupPage = sameTopDomain && top.window.document.getElementById("PopupAgent") != null; var isAnalogPopupPage = sameParentDomain && parent.window["Wade"] && parent.window["Wade"].dialog.hasOpendDialog(); var isPageRedirect = location.href.indexOf("?") != -1; var isTopNavPage = isPageRedirect && sameParentDomain && parent.document.getElementById("navframeset") != null; var sbtframe,isMsgPopup=false,isDirectPageFlow=false,isSubmitPageFlow = false,isInitPopupFrame = false;  if(typeof(Wade.excedesc)=='undefined'){  Wade.excedesc=(function(){   var dh=System.DomHelper;   var validate=Wade.validate;   var evt=Wade.event;   var page=Wade.page;   var dom=Wade.dom;   var util=Wade.util;   var popupDialog,viewErrorBtn;      function setInitPopupFrame(){    var currentNavFrame=Wade.nav.getActiveNavFrame();     sbtframe = (sameParentDomain && parent.document.getElementById("wade_sbtframe"));    isMsgPopup=(Wade.excedesc.HiddenFramePostError ||(function(){try{ return (sbtframe && sbtframe.contentWindow.location.href != "about:blank");}catch(ex){return false;}})());    isDirectPageFlow= sameParentDomain && (currentNavFrame?currentNavFrame:parent).document.getElementById("flowbody") != null;    isSubmitPageFlow = isDirectPageFlow && isMsgPopup;    if (!isMsgPopup && !Wade.excedesc.AsyncError) {     if (isSameDomain(parent) && parent.Wade != null) {      var popupFrameSrc = parent.Wade.dialog.getCurrentOpenFrame();      if(popupFrameSrc != null) {       isInitPopupFrame = util.getReduceUrl(popupFrameSrc) == util.getReduceUrl(window.location.href);      }     }    }currentNavFrame=null;   };   function getFrameObjByUp(target, objname) {    if (!compareDomain(target)) return null;    var obj = target.document.getElementById(objname);    if (obj != null) return obj;    if (top != target.window) {     return getFrameObjByUp(target.parent, objname);    }    return null;   };   function backHistoryPage() {    history.back();   };   function cancelExcedesc(){        var currentNavFrame=Wade.nav.getActiveNavFrame();    if (isMsgPopup) {     if (!Wade.excedesc.AsyncError && !Wade.excedesc.HiddenFramePostError) {      parent.endPageOverlay();     }else{      page.endPageOverlay();      System.fly("exceDescPageContent").remove();      System.CG();      }     if(sbtframe && sbtframe.nodeType){      sbtframe.contentWindow.location.href = "about:blank";      sbtframe.style.display = "none";     }    }else if(Wade.excedesc.AsyncError || Wade.excedesc.HiddenFramePostError){     parent.endPageOverlay();     page.endPageOverlay();     System.fly("exceDescPageContent").remove();     System.CG();    }else if (isInitPopupFrame){     closePopupFrame();    }else {     if (isPopupPage){      window.close();     } else if(isAnalogPopupPage){      Wade.page.cancel(true);     }else{       if(isTopNavPage) {       Wade.nav.closeNavFrameByLocation();      } else if (isDirectPageFlow) {       var pageflow = Wade.nav.getFrame(["flowtab", currentNavFrame?currentNavFrame:parent]).pageflow;       if (pageflow.alreadyFinish) {        backHistoryPage();        pageflow.endFlowOverlay();        pageflow.alreadyFinish = false;       } else {        pageflow.backPageStep();       }      }else {       backHistoryPage();      }     }    }    if((isDirectPageFlow && !Wade.excedesc.HiddenFramePostError) || (isSubmitPageFlow && Wade.excedesc.HiddenFramePostError)){      Wade.nav.getFrame(["flowtab", currentNavFrame?currentNavFrame:parent.parent]).pageflow.endFlowOverlay();    }    currentNavFrame=null;        Wade.excedesc.HiddenFramePostError=false;    Wade.excedesc.AsyncError=false;    removeKeyPressEvent("excedesc_breturn");    if(viewErrorBtn){     viewErrorBtn.destroy();     viewErrorBtn=null;    }     popupDialog.destroy();    popupDialog=null;   };         function copyStackInfo(){    var stackarea = dom.getElement("StackArea");    dom.copyToClipboard(stackarea.innerText);   };   var expanded=false,dlgWidth=376,dlgHeight=0;   function initExceDesc(){        var addButton=true,closeAble=true,dlgTitle="\u9519\u8BEF\u63D0\u793A\u4FE1\u606F",btnText="\u8FD4\u56DE";    if (self.name == "printframe") {     var em=dom.getElement("exceDescPageContent");                    if(em && em.nodeType){em=em.innerText;}else{em="";}     alert("\u64CD\u4F5C\u53D1\u751F\u9519\u8BEF\u0021 \n \u9519\u8BEF\u539F\u56E0\uFF1A" +em);em=null;    } else {     if (!Wade.excedesc.AsyncError) {      page.onPageLoad();     }     setInitPopupFrame();          if (isMsgPopup) {      if (!Wade.excedesc.AsyncError && !Wade.excedesc.HiddenFramePostError){       if(typeof(parent.Wade.excedesc)=='undefined'){ parent.Include('module/excedesc.js'); }        parent.Wade.excedesc.HiddenFramePostError=true;       parent.System.DomHelper.insertHtml("beforeend",parent.document.body,System.Common.filterScripts(document.body.innerHTML));       parent.Wade.excedesc.initExceDesc();       parent.setKeyPressEvent("excedesc_breturn","excedesc_breturn");       return;      }     }else if(Wade.excedesc.HiddenFramePostError){      dlgTitle="\u8868\u5355\u63D0\u4EA4\u9519\u8BEF";     }else if(Wade.excedesc.AsyncError){      dlgTitle="\u670d\u52a1\u5668\u7aef\u63d0\u793a";     }     page.endPageLoading();     page.beginPageOverlay();     validate.setDisabledElements(validate.getDisabledElements(), true);     if(Wade.excedesc.HiddenFramePostError || Wade.excedesc.AsyncError || isAnalogPopupPage || isPopupPage || isInitPopupFrame || isMsgPopup || isTopNavPage || isSubmitPageFlow) {      btnText = "\u5173\u95ED";     }else if(isPageRedirect && getFrameObjByUp(parent, "navframeset") != null) {      addButton=false;closeAble=false;     }     if(isAnalogPopupPage){      parent.Wade.dialog.recoverCurrentOpenFrame();     }     if((isDirectPageFlow && !Wade.excedesc.HiddenFramePostError) || (isSubmitPageFlow && Wade.excedesc.HiddenFramePostError)){      var currentNavFrame=Wade.nav.getActiveNavFrame();      Wade.nav.getFrame(["flowtab", currentNavFrame?currentNavFrame:parent]).pageflow.beginFlowOverlay();      currentNavFrame=null;     }                    mc=document.getElementById("exceDescMsgContent");     if(mc && mc.nodeType){dlgHeight=parseInt(mc.getAttribute("contentheight"),10);}mc=null;     var w=dh.getViewWidth();if(w<(dlgWidth+22)){dlgWidth=w-20;}     var h=dh.getViewHeight();if(h<dlgHeight+80){dlgHeight=h-100;}     popupDialog=new System.UI.Components.BasicDialog("exceDescPageContent", {          shim:false,          draggable:false,          closable:closeAble,          collapsible:false,                      modal:false,                      shadow:false,                      resizable:false,                      proxyDrag:false,                      fixedcenter:true,                      dialogWidth:dlgWidth,                      buttonAlign:"center",                      title:dlgTitle              });      var sa=document.getElementById("StackArea");           if(sa && sa.nodeType){      popupDialog.bbBtn = popupDialog.toolbox.createChild({cls:"x-dlg-bb"});            popupDialog.bbBtn.on("click", expandPopup);            popupDialog.bbBtn.dom.setAttribute("title","\u6700\u5927\u5316\u67E5\u770B\u8BE6\u60C5");            popupDialog.bbBtn.addClassOnOver("x-dlg-bb-over");             popupDialog.ssBtn = popupDialog.toolbox.createChild({cls:"x-dlg-ss"});            popupDialog.ssBtn.on("click", revertPopup);            popupDialog.ssBtn.dom.setAttribute("title","\u6700\u5C0F\u5316");            popupDialog.ssBtn.addClassOnOver("x-dlg-ss-over");                    viewErrorBtn=popupDialog.addButton("\u67E5\u770B\u8BE6\u7EC6\u9519\u8BEF",expandPopup);            viewErrorBtn.el.setStyle("margin-right","2px");                   (popupDialog.addButton("\u590D\u5236\u8BE6\u7EC6\u9519\u8BEF\u4FE1\u606F",copyStackInfo)).el.setStyle("margin-right","2px");           }sa=null;               if(closeAble){      popupDialog.close.on("click", cancelExcedesc);     }                   if(addButton){      popupDialog.addButton({btnid:"excedesc_breturn",text:btnText},cancelExcedesc);      setKeyPressEvent("excedesc_breturn","excedesc_breturn");     }      popupDialog.setContentSize(dlgWidth,dlgHeight);     popupDialog.show();     dom.focus("excedesc_breturn");          }     };   function revertPopup() {    if(expanded==true){     var d=document.getElementById("exceDescMsgContent");     if(d && d.nodeType){d.style.width="370px";}d=null;     d=document.getElementById("StackArea");     if(d && d.nodeType){d.style.display="none";}d=null;     viewErrorBtn.setText("\u67E5\u770B\u8BE6\u7EC6\u9519\u8BEF");     viewErrorBtn.setHandler(expandPopup);     popupDialog.setContentSize(dlgWidth,dlgHeight);          expanded=false;    }   };   function expandPopup() {    if(expanded==false){     var w=dh.getViewWidth(true)-20;     var d=document.getElementById("exceDescMsgContent");     if(d && d.nodeType){d.style.width=(w-80) + "px";}d=null;     d=document.getElementById("StackArea");     if(d && d.nodeType){d.style.display="";}d=null;     viewErrorBtn.setText("\u9690\u85CF\u8BE6\u7EC6\u9519\u8BEF");     viewErrorBtn.setHandler(revertPopup);     popupDialog.resizeTo(w,dh.getViewHeight(true)-20);          expanded=true;    }   };   function closePopupFrame() {    var popupTarget = isMsgPopup ? parent : self;    popupTarget.Wade.page.cancel(true);    popupTarget.parent.Wade.dialog.recoverCurrentOpenFrame();   };   return {    HiddenFramePostError:false,    AsyncError:false,    initExceDesc:function(){     initExceDesc();    },    cancelExcedesc:function(){     cancelExcedesc();    },    clickStackCtrl:function(){     clickStackCtrl();    },    copyStackInfo:function(){     copyStackInfo();    },    revertPopup:function(){     revertPopup();    },    expandPopup:function(){     expandPopup();    }   };  })(); }})();