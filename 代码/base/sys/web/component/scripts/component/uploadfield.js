(function(){if(typeof(Wade.component.uploadField)=='undefined'){Wade.component.uploadField=(function(){ var dom = Wade.dom; var context=Wade.context; var dialog = Wade.dialog; var upload = Wade.upload;  var uploadfileDialog=null; var fieldObjName=null; var ctlobj,record,reserved,fileTotal,editobj; function removeFileSpace(objname, tfileId) {  var editstr = "";  var editobj = dom.getElement(objname);  var attachs = editobj.value.split("/");  for (var i=0; i<attachs.length; i++) {   var attach = attachs[i];   var fileId = attach.split(":")[0];   var fileName = attach.split(":")[1];   if (fileId != tfileId) {    editstr += (editstr == "" ? "" : "/") + attach;   }  }  editobj.value = editstr; };  function loadUploadInfo(objname){   fieldObjName=objname;   ctlobj = dom.getElement("UPLOAD_DIV_" + objname);   record = ctlobj.getAttribute("record");   reserved = ctlobj.getAttribute("reserved");   fileTotal = ctlobj.getAttribute("fileTotal");   editobj = dom.getElement(objname);   } return {    popupUploadDialog : function(objname) {   loadUploadInfo(objname);   if (editobj.value != "" && fileTotal != null && parseInt(fileTotal) == editobj.value.split("/").length) {    alert("\u4E0A\u4F20\u6587\u4EF6\u6570\u4E0D\u80FD\u8D85\u8FC7" + fileTotal + "\u4E2A\u0021");    return false;   }   if(!uploadfileDialog){    var url = context.getContextName() + "?service=page/component.popups.editor.upload_attach";    uploadfileDialog=new System.UI.Components.BasicDialog("uploadfield_dialog", {     autoCreate:true,                    shadow: false,                    draggable: false,                    resizable:false,                    modal: true,                    fixedcenter:true,                    shim:false,                    width:400, height:190,                    title:"\u4E0A\u4F20\u6587\u4EF6"                });                var f=uploadfileDialog.body.createChild({                 tag:"iframe",                 style:{border:"none",width:"100%",height:"100%"},                 scroll:"no",frameborder:"0",src:""             });f.dom.contentWindow.location=url;   }   uploadfileDialog.show();        },  addUploadFileDialogOnShowListener:function(fn,scope){   if(uploadfileDialog && typeof(fn)=="function"){    uploadfileDialog.on("show",fn,scope);   }  },  closeDialog:function(){   if(uploadfileDialog)uploadfileDialog.hide();   ctlobj = null;record = null;reserved =null;   fileTotal = null;editobj =null;   System.CG();  },  getRecord:function(){return record;},  getReserved:function(){return reserved;},  insertUploadFile:function(retobj){     if (retobj != null) {    var filehref = record == "true" && reserved == "false" ? "attach?action=delete&file_id=" + retobj.fileId : "javascript:void(0)";    var fileclass = record == "true" && reserved == "false" ? "e_bLinkDeleteNB" : "e_bLinkDeleteNBDis";    var fileobj = document.createElement("LI");    fileobj.innerHTML += retobj.fileUrl;    fileobj.innerHTML += "<a href='" + filehref + "' target='printframe' class='" + fileclass + "' title='\u5220\u9664' onfocus='this.blur();' onclick='return Wade.component.uploadField.deleteUploadFile(this, \"" + fieldObjName + "\", \"" + retobj.fileId + "\");'><span>&nbsp;</span></a>";    ctlobj.appendChild(fileobj);fileobj=null;    editobj.value += (editobj.value == "" ? "" : "/") + retobj.fileId + ":" + retobj.fileName;   }  },    deleteUploadFile : function(obj, objname, tfileId) {   if (!window.confirm("\u786E\u5B9A\u5220\u9664\u6587\u4EF6\u4E48\uFF1F")) return false;   obj.parentNode.parentNode.removeChild(obj.parentNode);   removeFileSpace(objname, tfileId);   if(isNaN(tfileId)){return false;}   return true;  },    setUploadFieldContent : function(objname, isdelete) {   loadUploadInfo(objname);   if (editobj.value == "") return;      var attachs = editobj.value.split("/");   for (var i=0; i<attachs.length; i++) {    var attach = attachs[i];    var fileId = attach.split(":")[0];    var fileName = attach.split(":")[1];    if (!fileId || !fileName) continue;        var fileobj = document.createElement("LI");    fileobj.innerHTML += "<a href='attach?file_source=domain&file_id=" + fileId + "' style='background-image:url(" + upload.getFileImage(fileName) + ");' class='e_bLinkDownloadNB'><span>" + fileName + "</span></a>";    if (isdelete != null && isdelete) fileobj.innerHTML += "<a href='attach?action=delete&file_id=" + fileId + "' target='printframe' class='e_bLinkDeleteNB' title='\u5220\u9664' onclick='return Wade.component.uploadField.deleteUploadFile(this, \"" + objname + "\", \"" + fileId + "\");'><span>&nbsp;</span></a>";    ctlobj.appendChild(fileobj);   }  } }})();}})();